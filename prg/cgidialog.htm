<html>
<head>
<title>
Seed7 Program listing</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="author" content="Thomas Mertes" />
<meta name="copyright" content="Thomas Mertes" />
<meta name="keywords" content="Seed7, SeedSeven, Seed, Seven, 7, programming, language, extensible, extendable" />
<meta name="description" content="Seed7 - The extensible programming language" />
<meta name="page-topic" content="programming language, computer, software, downloads" />
<meta name="audience" content="all" />
<meta name="content-language" content="en" />
<meta name="robots" content="index,follow" />
<link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon" />
<link rel="stylesheet" href="../style1.css" type="text/css" />
</head>
<body>
<pre class="indent">

<span class="comment">(********************************************************************)</span>
<span class="comment">(*                                                                  *)</span>
<span class="comment">(*  cgidialog.s7i   Dialogs to be shown with a web browser.         *)</span>
<span class="comment">(*  Copyright (C) 2013, 2015, 2017, 2021  Thomas Mertes             *)</span>
<span class="comment">(*                                                                  *)</span>
<span class="comment">(*  This file is part of the Seed7 Runtime Library.                 *)</span>
<span class="comment">(*                                                                  *)</span>
<span class="comment">(*  The Seed7 Runtime Library is free software; you can             *)</span>
<span class="comment">(*  redistribute it and/or modify it under the terms of the GNU     *)</span>
<span class="comment">(*  Lesser General Public License as published by the Free Software *)</span>
<span class="comment">(*  Foundation; either version 2.1 of the License, or (at your      *)</span>
<span class="comment">(*  option) any later version.                                      *)</span>
<span class="comment">(*                                                                  *)</span>
<span class="comment">(*  The Seed7 Runtime Library is distributed in the hope that it    *)</span>
<span class="comment">(*  will be useful, but WITHOUT ANY WARRANTY; without even the      *)</span>
<span class="comment">(*  implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR *)</span>
<span class="comment">(*  PURPOSE.  See the GNU Lesser General Public License for more    *)</span>
<span class="comment">(*  details.                                                        *)</span>
<span class="comment">(*                                                                  *)</span>
<span class="comment">(*  You should have received a copy of the GNU Lesser General       *)</span>
<span class="comment">(*  Public License along with this program; if not, write to the    *)</span>
<span class="comment">(*  Free Software Foundation, Inc., 51 Franklin Street,             *)</span>
<span class="comment">(*  Fifth Floor, Boston, MA  02110-1301, USA.                       *)</span>
<span class="comment">(*                                                                  *)</span>
<span class="comment">(********************************************************************)</span>


<span class="keywd">include</span> <span class="stri">"<a class="lib" href="../prg/html_ent.htm">html_ent.s7i</a>"</span>;
<span class="keywd">include</span> <span class="stri">"<a class="lib" href="../prg/unicode.htm">unicode.s7i</a>"</span>;
<span class="keywd">include</span> <span class="stri">"<a class="lib" href="../prg/encoding.htm">encoding.s7i</a>"</span>;
<span class="keywd">include</span> <span class="stri">"<a class="lib" href="../prg/draw.htm">draw.s7i</a>"</span>;
<span class="keywd">include</span> <span class="stri">"<a class="lib" href="../prg/bmp.htm">bmp.s7i</a>"</span>;

<span class="keywd">const</span> <span class="type">type</span>: paramHashType <span class="keywd">is</span> <span class="type">hash</span> <span class="type">[</span><span class="type">string</span><span class="type">]</span> <span class="type">string</span>;


<span class="comment">(**
 *  Interface type for dialog elements.
 *  The dialogElement interface is implemented with ''emptyDialog'',
 *  ''header'', ''label'', ''image'', ''space'', ''vspace'',
 *  ''textField'', ''passwordField'', ''textArea'', ''checkbox'',
 *  ''radioButton'', ''resetButton'', ''submitButton'', ''closeButton''.
 *)</span>
<span class="keywd">const</span> <span class="type">type</span>: dialogElement <span class="keywd">is</span> new interface;

<span class="keywd">const</span> <span class="type">type</span>: emptyDialog <span class="keywd">is</span> new <span class="keywd">struct</span>
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(emptyDialog, dialogElement);

<span class="keywd">const</span> <span class="type">dialogElement</span>: (attr dialogElement) . value <span class="keywd">is</span> emptyDialog.value;

<span class="keywd">var</span> <span class="type">integer</span>: currentDialogElementId <span class="keywd">is</span> 0;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: genDialogElementName <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: name <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">begin</span>
    incr(currentDialogElementId);
    name := <span class="stri">"name"</span> &lt;&amp; currentDialogElementId;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">type</span>: webPage <span class="keywd">is</span> new <span class="keywd">struct</span>
    <span class="keywd">var</span> <span class="type">string</span>: title <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">dialogElement</span>: dialog <span class="keywd">is</span> dialogElement.value;
    <span class="keywd">var</span> <span class="type">boolean</span>: isForm <span class="keywd">is</span> FALSE;
  <span class="keywd">end</span> <span class="keywd">struct</span>;

<span class="keywd">const</span> <span class="type">proc</span>: assignName (<span class="keywd">inout</span> <span class="type">dialogElement</span>: aDialog, <span class="keywd">inout</span> <span class="type">integer</span>: id)       <span class="keywd">is</span> DYNAMIC;
<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">dialogElement</span>: aDialog, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> DYNAMIC;
<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">dialogElement</span>: aDialog)                          <span class="keywd">is</span> DYNAMIC;


<span class="keywd">const</span> <span class="type">func</span> <span class="type">webPage</span>: webPage (<span class="op">in</span> <span class="type">string</span>: title, <span class="op">in</span> <span class="type">dialogElement</span>: dialog) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">webPage</span>: page <span class="keywd">is</span> webPage.value;
  <span class="keywd">begin</span>
    page.title := title;
    page.dialog := dialog;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">webPage</span>: webForm (<span class="op">in</span> <span class="type">string</span>: title, <span class="op">in</span> <span class="type">dialogElement</span>: dialog) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">webPage</span>: page <span class="keywd">is</span> webPage.value;
  <span class="keywd">begin</span>
    page.title := title;
    page.dialog := dialog;
    page.isForm := TRUE;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">webPage</span>: aWebPage, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">string</span>: aKey <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">string</span>: aValue <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">begin</span>
    <span class="comment"># for aValue key aKey range paramHash do</span>
    <span class="comment">#   writeln(aKey &lt;&amp; "=" &lt;&amp; aValue);</span>
    <span class="comment"># end for;</span>
    update(aWebPage.dialog, paramHash);
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: send (<span class="keywd">inout</span> <span class="type">webPage</span>: aWebPage, <span class="keywd">inout</span> <span class="type">file</span>: outFile) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">string</span>: header <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("send");</span>
    content := <span class="stri">"\
        \&lt;!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">\n\
        \&lt;html>&lt;head>&lt;title>"</span> &lt;&amp; aWebPage.title &lt;&amp; <span class="stri">"&lt;/title>&lt;/head>\n\
        \&lt;body>\n"</span>;
    <span class="keywd">if</span> aWebPage.isForm <span class="keywd">then</span>
      content &amp;:= <span class="stri">"&lt;form method=\"post\" action=\"\" accept-charset=\"UTF-8\">\n"</span>;
      content &amp;:= toHtml(aWebPage.dialog);
      content &amp;:= <span class="stri">"&lt;/form>\n"</span>;
    <span class="keywd">else</span>
      content &amp;:= toHtml(aWebPage.dialog);
    <span class="keywd">end</span> <span class="keywd">if</span>;
    content &amp;:= <span class="stri">"\
        \&lt;/body>\n\
        \&lt;/html>\n"</span>;
    header := <span class="stri">"HTTP/1.1 200 OK\r\n\
              \Content-Type: text/html; charset=UTF-8\r\n\
              \Connection: keep-alive\r\n\
              \Content-Length: "</span> &lt;&amp; length(content) &lt;&amp; <span class="stri">"\r\n\
              \\r\n"</span>;
    <span class="comment"># writeln(header &amp; content);</span>
    <span class="keywd">block</span>
      write(outFile, header &amp; content);
    exception
      catch FILE_ERROR:
        noop;  <span class="comment"># Ignore error (the browser has already closed the socket).</span>
    <span class="keywd">end</span> <span class="keywd">block</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: header <span class="keywd">is</span> new <span class="keywd">struct</span>
    <span class="keywd">var</span> <span class="type">integer</span>: level <span class="keywd">is</span> 0;
    <span class="keywd">var</span> <span class="type">string</span>: name <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(header, dialogElement);

<span class="comment">(**
 *  Create a header dialogElement with the given ''level'' and ''name''.
 *  @return a header dialogElement.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">header</span>: header (<span class="op">in</span> <span class="type">integer</span>: level, <span class="op">in</span> <span class="type">string</span>: name) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">header</span>: aHeader <span class="keywd">is</span> header.value;
  <span class="keywd">begin</span>
    aHeader.level := level;
    aHeader.name := name;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: assignName (<span class="keywd">inout</span> <span class="type">header</span>: aHeader, <span class="keywd">inout</span> <span class="type">integer</span>: id) <span class="keywd">is</span> noop;
<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">header</span>: aHeader, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> noop;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">header</span>: aHeader) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("header");</span>
    content := <span class="stri">"&lt;h"</span> &lt;&amp; aHeader.level &lt;&amp; <span class="stri">">"</span> &lt;&amp;
               encodeHtmlContent(toUtf8(aHeader.name)) &lt;&amp; <span class="stri">"&lt;/h"</span> &lt;&amp; aHeader.level &lt;&amp; <span class="stri">">"</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: label <span class="keywd">is</span> new <span class="keywd">struct</span>
    <span class="keywd">var</span> <span class="type">string</span>: name <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(label, dialogElement);

<span class="comment">(**
 *  Create a label dialogElement with the given ''name''.
 *  @return a label dialogElement with the ''name''.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">label</span>: label (<span class="op">in</span> <span class="type">string</span>: name) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">label</span>: aLabel <span class="keywd">is</span> label.value;
  <span class="keywd">begin</span>
    aLabel.name := name;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: assignName (<span class="keywd">inout</span> <span class="type">label</span>: aLabel, <span class="keywd">inout</span> <span class="type">integer</span>: id) <span class="keywd">is</span> noop;
<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">label</span>: aLabel, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> noop;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">label</span>: aLabel) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("label");</span>
    content := <span class="stri">"&lt;p>"</span> &lt;&amp; replace(encodeHtmlContent(toUtf8(aLabel.name)), <span class="stri">"\n"</span>, <span class="stri">"&lt;br/>"</span>) &lt;&amp; <span class="stri">"&lt;/p>"</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: image <span class="keywd">is</span> new <span class="keywd">struct</span>
    <span class="keywd">var</span> <span class="type">string</span>: name <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">integer</span>: width <span class="keywd">is</span> 0;
    <span class="keywd">var</span> <span class="type">integer</span>: height <span class="keywd">is</span> 0;
    <span class="keywd">var</span> <span class="type">string</span>: src <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(image, dialogElement);

<span class="comment">(**
 *  Create an image dialogElement from a given ''pixmap''.
 *  @return an image dialogElement with the ''pixmap''.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">image</span>: image (<span class="op">in</span> <span class="type">PRIMITIVE_WINDOW</span>: pixmap) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">image</span>: anImage <span class="keywd">is</span> image.value;
  <span class="keywd">begin</span>
    anImage.name := genDialogElementName;
    anImage.width := width(pixmap);
    anImage.height := height(pixmap);
    <span class="keywd">if</span> pixmap = PRIMITIVE_WINDOW.value <span class="keywd">then</span>
      anImage.src := <span class="stri">"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="</span>;
    <span class="keywd">else</span>
      anImage.src := <span class="stri">"data:image/bmp;base64,"</span> &amp; toBase64(str(pixmap, BMP));
    <span class="keywd">end</span> <span class="keywd">if</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: assignName (<span class="keywd">inout</span> <span class="type">image</span>: anImage, <span class="keywd">inout</span> <span class="type">integer</span>: id) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">begin</span>
    anImage.name := <span class="stri">"name"</span> &lt;&amp; id;
    incr(id);
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">image</span>: anImage, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> noop;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">image</span>: anImage) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("image");</span>
    content := <span class="stri">"&lt;img src=\""</span> &lt;&amp; anImage.src &lt;&amp; <span class="stri">"\" alt=\""</span> &lt;&amp; anImage.name &lt;&amp; <span class="stri">"\">"</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: space <span class="keywd">is</span> new <span class="keywd">struct</span>
    <span class="keywd">var</span> <span class="type">integer</span>: width <span class="keywd">is</span> 0;
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(space, dialogElement);

<span class="comment">(**
 *  Create a space dialogElement with the given ''width''.
 *  @return a space dialogElement.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">space</span>: space (<span class="op">in</span> <span class="type">integer</span>: width) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">space</span>: aSpace <span class="keywd">is</span> space.value;
  <span class="keywd">begin</span>
    aSpace.width := width;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: assignName (<span class="keywd">inout</span> <span class="type">space</span>: aSpace, <span class="keywd">inout</span> <span class="type">integer</span>: id) <span class="keywd">is</span> noop;
<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">space</span>: aSpace, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> noop;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">space</span>: aSpace) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">integer</span>: count <span class="keywd">is</span> 0;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("space");</span>
    content := <span class="stri">"&lt;p>"</span>;
    <span class="keywd">for</span> count <span class="keywd">range</span> 1 <span class="keywd">to</span> aSpace.width <span class="keywd">do</span>
      content &amp;:= <span class="stri">"&amp;nbsp;"</span>;
    <span class="keywd">end</span> <span class="keywd">for</span>;
    content &amp;:= <span class="stri">"&lt;/p>"</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: vspace <span class="keywd">is</span> new <span class="keywd">struct</span>
    <span class="keywd">var</span> <span class="type">integer</span>: height <span class="keywd">is</span> 0;
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(vspace, dialogElement);

<span class="comment">(**
 *  Create a vspace (vertical space) dialogElement with the given ''height''.
 *  @return a vspace dialogElement.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">vspace</span>: vspace (<span class="op">in</span> <span class="type">integer</span>: height) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">vspace</span>: aVSpace <span class="keywd">is</span> vspace.value;
  <span class="keywd">begin</span>
    aVSpace.height := height;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: assignName (<span class="keywd">inout</span> <span class="type">vspace</span>: aVSpace, <span class="keywd">inout</span> <span class="type">integer</span>: id) <span class="keywd">is</span> noop;
<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">vspace</span>: aVSpace, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> noop;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">vspace</span>: aVSpace) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">integer</span>: count <span class="keywd">is</span> 0;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("vspace");</span>
    content := <span class="stri">"&lt;p style=\"margin-bottom: "</span> &lt;&amp; aVSpace.height &lt;&amp; <span class="stri">"\">&lt;/p>"</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: script <span class="keywd">is</span> new <span class="keywd">struct</span>
    <span class="keywd">var</span> <span class="type">string</span>: statements <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(script, dialogElement);

<span class="keywd">const</span> <span class="type">func</span> <span class="type">script</span>: script (<span class="op">in</span> <span class="type">string</span>: statements) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">script</span>: aScript <span class="keywd">is</span> script.value;
  <span class="keywd">begin</span>
    aScript.statements := statements;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: assignName (<span class="keywd">inout</span> <span class="type">script</span>: aScript, <span class="keywd">inout</span> <span class="type">integer</span>: id) <span class="keywd">is</span> noop;
<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">script</span>: aScript, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> noop;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">script</span>: aScript) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("script");</span>
    content := <span class="stri">"&lt;script language=\"JavaScript\" type=\"text/javascript\">"</span> &lt;&amp;
               encodeHtmlContent(toUtf8(aScript.statements))
               &lt;&amp; <span class="stri">"&lt;/script>"</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: textField <span class="keywd">is</span> new <span class="keywd">struct</span>
    <span class="keywd">var</span> <span class="type">string</span>: name <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">integer</span>: size <span class="keywd">is</span> 0;
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(textField, dialogElement);

<span class="comment">(**
 *  Create a textField dialogElement with the given ''content'' and ''size''.
 *  @return a textField dialogElement.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">textField</span>: textField (<span class="op">in</span> <span class="type">string</span>: content, <span class="op">in</span> <span class="type">integer</span>: size) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">textField</span>: aTextField <span class="keywd">is</span> textField.value;
  <span class="keywd">begin</span>
    aTextField.name := genDialogElementName;
    aTextField.content := content;
    aTextField.size := size;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: assignName (<span class="keywd">inout</span> <span class="type">textField</span>: aTextField, <span class="keywd">inout</span> <span class="type">integer</span>: id) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">begin</span>
    aTextField.name := <span class="stri">"name"</span> &lt;&amp; id;
    incr(id);
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">textField</span>: aTextField, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">begin</span>
    <span class="keywd">if</span> aTextField.name <span class="op">in</span> paramHash <span class="keywd">then</span>
      aTextField.content := paramHash[aTextField.name];
    <span class="keywd">end</span> <span class="keywd">if</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">textField</span>: aTextField) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("textField");</span>
    content := <span class="stri">"&lt;input type=\"text\" name=\""</span> &lt;&amp; aTextField.name &lt;&amp;
               <span class="stri">"\" value="</span> &lt;&amp; quoteHtmlAttrValue(toUtf8(aTextField.content)) &lt;&amp; <span class="stri">" "</span>;
    <span class="keywd">if</span> aTextField.size &lt;> 0 <span class="keywd">then</span>
      content &amp;:= <span class="stri">"size=\""</span> &lt;&amp; aTextField.size &lt;&amp; <span class="stri">"\" "</span>;
    <span class="keywd">end</span> <span class="keywd">if</span>;
    content &amp;:= <span class="stri">"/>\n"</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: passwordField <span class="keywd">is</span> new <span class="keywd">struct</span>
    <span class="keywd">var</span> <span class="type">string</span>: name <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">integer</span>: size <span class="keywd">is</span> 0;
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(passwordField, dialogElement);

<span class="comment">(**
 *  Create a passwordField dialogElement with the given ''content'' and ''size''.
 *  @return a passwordField dialogElement.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">passwordField</span>: passwordField (<span class="op">in</span> <span class="type">string</span>: content, <span class="op">in</span> <span class="type">integer</span>: size) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">passwordField</span>: aPasswordField <span class="keywd">is</span> passwordField.value;
  <span class="keywd">begin</span>
    aPasswordField.name := genDialogElementName;
    aPasswordField.content := content;
    aPasswordField.size := size;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: assignName (<span class="keywd">inout</span> <span class="type">passwordField</span>: aPasswordField, <span class="keywd">inout</span> <span class="type">integer</span>: id) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">begin</span>
    aPasswordField.name := <span class="stri">"name"</span> &lt;&amp; id;
    incr(id);
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">passwordField</span>: aPasswordField, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">begin</span>
    <span class="keywd">if</span> aPasswordField.name <span class="op">in</span> paramHash <span class="keywd">then</span>
      aPasswordField.content := paramHash[aPasswordField.name];
    <span class="keywd">end</span> <span class="keywd">if</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">passwordField</span>: aPasswordField) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("passwordField");</span>
    content := <span class="stri">"&lt;input type=\"password\" name=\""</span> &lt;&amp; aPasswordField.name &lt;&amp;
               <span class="stri">"\" value="</span> &lt;&amp; quoteHtmlAttrValue(toUtf8(aPasswordField.content)) &lt;&amp; <span class="stri">" "</span>;
    <span class="keywd">if</span> aPasswordField.size &lt;> 0 <span class="keywd">then</span>
      content &amp;:= <span class="stri">"size=\""</span> &lt;&amp; aPasswordField.size &lt;&amp; <span class="stri">"\" "</span>;
    <span class="keywd">end</span> <span class="keywd">if</span>;
    content &amp;:= <span class="stri">"/>\n"</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: textArea <span class="keywd">is</span> new <span class="keywd">struct</span>
    <span class="keywd">var</span> <span class="type">string</span>: name <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">integer</span>: rows <span class="keywd">is</span> 0;
    <span class="keywd">var</span> <span class="type">integer</span>: cols <span class="keywd">is</span> 0;
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(textArea, dialogElement);

<span class="comment">(**
 *  Create a textArea dialogElement with the given ''rows'' and ''cols''.
 *  @return a textArea dialogElement.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">textArea</span>: textArea (<span class="op">in</span> <span class="type">integer</span>: rows, <span class="op">in</span> <span class="type">integer</span>: cols) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">textArea</span>: aTextArea <span class="keywd">is</span> textArea.value;
  <span class="keywd">begin</span>
    aTextArea.name := genDialogElementName;
    aTextArea.rows := rows;
    aTextArea.cols := cols;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: assignName (<span class="keywd">inout</span> <span class="type">textArea</span>: aTextArea, <span class="keywd">inout</span> <span class="type">integer</span>: id) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">begin</span>
    aTextArea.name := <span class="stri">"name"</span> &lt;&amp; id;
    incr(id);
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">textArea</span>: aTextArea, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">begin</span>
    <span class="keywd">if</span> aTextArea.name <span class="op">in</span> paramHash <span class="keywd">then</span>
      aTextArea.content := paramHash[aTextArea.name];
    <span class="keywd">end</span> <span class="keywd">if</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">textArea</span>: aTextArea) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("textArea");</span>
    content := <span class="stri">"&lt;textarea name=\""</span> &lt;&amp; aTextArea.name &lt;&amp; <span class="stri">"\" rows=\""</span> &lt;&amp; aTextArea.rows &lt;&amp;
               <span class="stri">"\" cols=\""</span> &lt;&amp; aTextArea.cols &lt;&amp; <span class="stri">"\" wrap=\"virtual\">\n"</span>;
    content &amp;:= encodeHtmlContent(toUtf8(aTextArea.content));
    content &amp;:= <span class="stri">"&lt;/textarea>\n"</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: checkbox <span class="keywd">is</span> new <span class="keywd">struct</span>
    <span class="keywd">var</span> <span class="type">string</span>: name <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">boolean</span>: checked <span class="keywd">is</span> FALSE;
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(checkbox, dialogElement);

<span class="comment">(**
 *  Create a checkbox dialogElement with the given ''name''.
 *  @return a checkbox dialogElement.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">checkbox</span>: checkbox (<span class="op">in</span> <span class="type">string</span>: name) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">checkbox</span>: aCheckbox <span class="keywd">is</span> checkbox.value;
  <span class="keywd">begin</span>
    aCheckbox.name := name;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: assignName (<span class="keywd">inout</span> <span class="type">checkbox</span>: aCheckbox, <span class="keywd">inout</span> <span class="type">integer</span>: id) <span class="keywd">is</span> noop;

<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">checkbox</span>: aCheckbox, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">begin</span>
    aCheckbox.checked := aCheckbox.name <span class="op">in</span> paramHash;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">checkbox</span>: aCheckbox) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("checkbox");</span>
    content := <span class="stri">"&lt;input type=\"checkbox\" name=\""</span> &lt;&amp; aCheckbox.name &lt;&amp; <span class="stri">"\" value=\""</span> &lt;&amp; aCheckbox.name &lt;&amp; <span class="stri">"\""</span>;
    <span class="keywd">if</span> aCheckbox.checked <span class="keywd">then</span>
      content &amp;:= <span class="stri">" checked=\"checked\""</span>;
    <span class="keywd">end</span> <span class="keywd">if</span>;
    content &amp;:= <span class="stri">" />"</span> &lt;&amp; aCheckbox.name &lt;&amp; <span class="stri">"&lt;br />\n"</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: radioButton <span class="keywd">is</span> new <span class="keywd">struct</span>
    <span class="keywd">var</span> <span class="type">string</span>: name <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">array</span> <span class="type">string</span>: labelList <span class="keywd">is</span> 0 <span class="op">times</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">string</span>: selected <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(radioButton, dialogElement);

<span class="comment">(**
 *  Create a radioButton dialogElement with the given ''labelList''.
 *  @return a radioButton dialogElement.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">radioButton</span>: radioButton (<span class="op">in</span> <span class="type">array</span> <span class="type">string</span>: labelList) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">radioButton</span>: aRadioButton <span class="keywd">is</span> radioButton.value;
  <span class="keywd">begin</span>
    aRadioButton.name := genDialogElementName;
    aRadioButton.labelList := labelList;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: assignName (<span class="keywd">inout</span> <span class="type">radioButton</span>: aRadioButton, <span class="keywd">inout</span> <span class="type">integer</span>: id) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">begin</span>
    aRadioButton.name := <span class="stri">"name"</span> &lt;&amp; id;
    incr(id);
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">radioButton</span>: aRadioButton, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">string</span>: label <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">begin</span>
    <span class="keywd">for</span> label <span class="keywd">range</span> aRadioButton.labelList <span class="keywd">do</span>
      <span class="keywd">if</span> aRadioButton.name <span class="op">in</span> paramHash <span class="op">and</span> paramHash[aRadioButton.name] = label <span class="keywd">then</span>
        aRadioButton.selected := label;
      <span class="keywd">end</span> <span class="keywd">if</span>;
    <span class="keywd">end</span> <span class="keywd">for</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">radioButton</span>: aRadioButton) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">string</span>: label <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("radioButton");</span>
    <span class="keywd">for</span> label <span class="keywd">range</span> aRadioButton.labelList <span class="keywd">do</span>
      content &amp;:= <span class="stri">"&lt;input type=\"radio\" name=\""</span> &lt;&amp; aRadioButton.name &lt;&amp; <span class="stri">"\" value=\""</span> &lt;&amp; label &lt;&amp; <span class="stri">"\""</span>;
      <span class="keywd">if</span> aRadioButton.selected = label <span class="keywd">then</span>
        content &amp;:= <span class="stri">" checked=\"checked\""</span>;
      <span class="keywd">end</span> <span class="keywd">if</span>;
      content &amp;:= <span class="stri">" />"</span> &lt;&amp; label &lt;&amp; <span class="stri">"&lt;br />\n"</span>;
    <span class="keywd">end</span> <span class="keywd">for</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: resetButton <span class="keywd">is</span> new <span class="keywd">struct</span>
    <span class="keywd">var</span> <span class="type">string</span>: name <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">string</span>: label <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">string</span>: src <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">dialogElement</span>: element <span class="keywd">is</span> dialogElement.value;
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(resetButton, dialogElement);

<span class="comment">(**
 *  Create a reset button dialogElement with a [[string]] ''label''.
 *  @return a reset button dialogElement with the ''label''.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">resetButton</span>: resetButton (<span class="op">in</span> <span class="type">string</span>: label) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">resetButton</span>: aResetButton <span class="keywd">is</span> resetButton.value;
  <span class="keywd">begin</span>
    aResetButton.name := genDialogElementName;
    aResetButton.label := label;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="comment">(**
 *  Create reset button dialogElement with a ''pixmap'' as label.
 *  @return a reset button dialogElement with the ''pixmap''.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">resetButton</span>: resetButton (<span class="op">in</span> <span class="type">PRIMITIVE_WINDOW</span>: pixmap) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">resetButton</span>: aResetButton <span class="keywd">is</span> resetButton.value;
  <span class="keywd">begin</span>
    aResetButton.name := genDialogElementName;
    aResetButton.src := <span class="stri">"data:image/bmp;base64,"</span> &amp; toBase64(str(pixmap, BMP));
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="comment">(**
 *  Create reset button dialogElement with a ''dialogElement'' as label.
 *  @return a reset button dialogElement with the ''dialogElement''.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">resetButton</span>: resetButton (<span class="op">in</span> <span class="type">dialogElement</span>: element) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">resetButton</span>: aResetButton <span class="keywd">is</span> resetButton.value;
  <span class="keywd">begin</span>
    aResetButton.name := genDialogElementName;
    aResetButton.element := element;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: assignName (<span class="keywd">inout</span> <span class="type">resetButton</span>: aResetButton, <span class="keywd">inout</span> <span class="type">integer</span>: id) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">begin</span>
    aResetButton.name := <span class="stri">"name"</span> &lt;&amp; id;
    incr(id);
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">resetButton</span>: aResetButton, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> noop;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">resetButton</span>: aResetButton) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("resetButton");</span>
    <span class="keywd">if</span> aResetButton.src &lt;> <span class="stri">""</span> <span class="keywd">then</span>
<span class="comment">#      content := "&lt;input type=\"image\" src=\"" &lt;&amp; aResetButton.src &lt;&amp;</span>
<span class="comment">#                 "\" name=\"" &lt;&amp; aResetButton.name &lt;&amp; "\" />\n";</span>
      content := <span class="stri">"&lt;button type=\"reset\" name=\""</span> &lt;&amp; aResetButton.name &lt;&amp; <span class="stri">"\">"</span> &lt;&amp;
                 <span class="stri">"&lt;img src=\""</span> &lt;&amp; aResetButton.src &lt;&amp; <span class="stri">"\">&lt;/button>\n"</span>;
    <span class="keywd">elsif</span> aResetButton.element &lt;> dialogElement.value <span class="keywd">then</span>
      content := <span class="stri">"&lt;button type=\"reset\" name=\""</span> &lt;&amp; aResetButton.name &lt;&amp; <span class="stri">"\">"</span> &lt;&amp;
                 toHtml(aResetButton.element) &lt;&amp;
                 <span class="stri">"&lt;/button>\n"</span>;
    <span class="keywd">elsif</span> aResetButton.label &lt;> <span class="stri">""</span> <span class="keywd">then</span>
      content := <span class="stri">"&lt;input type=\"reset\" name=\""</span> &lt;&amp; aResetButton.name &lt;&amp;
                 <span class="stri">"\" value=\""</span> &lt;&amp; aResetButton.label &lt;&amp; <span class="stri">"\" />\n"</span>;
    <span class="keywd">else</span>
      content := <span class="stri">"&lt;input type=\"reset\" name=\""</span> &lt;&amp; aResetButton.name &lt;&amp; <span class="stri">"\" />\n"</span>;
    <span class="keywd">end</span> <span class="keywd">if</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: submitButton <span class="keywd">is</span> new <span class="keywd">struct</span>
    <span class="keywd">var</span> <span class="type">string</span>: name <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">string</span>: label <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">string</span>: src <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">dialogElement</span>: element <span class="keywd">is</span> dialogElement.value;
    <span class="keywd">var</span> <span class="type">boolean</span>: activated <span class="keywd">is</span> FALSE;
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(submitButton, dialogElement);

<span class="comment">(**
 *  Create a submit button dialogElement with a [[string]] ''label''.
 *  @return a submit button dialogElement with the ''label''.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">submitButton</span>: submitButton (<span class="op">in</span> <span class="type">string</span>: label) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">submitButton</span>: aSubmitButton <span class="keywd">is</span> submitButton.value;
  <span class="keywd">begin</span>
    aSubmitButton.name := genDialogElementName;
    aSubmitButton.label := label;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="comment">(**
 *  Create submit button dialogElement with a ''pixmap'' as label.
 *  @return a submit button dialogElement with the ''pixmap''.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">submitButton</span>: submitButton (<span class="op">in</span> <span class="type">PRIMITIVE_WINDOW</span>: pixmap) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">submitButton</span>: aSubmitButton <span class="keywd">is</span> submitButton.value;
  <span class="keywd">begin</span>
    aSubmitButton.name := genDialogElementName;
    aSubmitButton.src := <span class="stri">"data:image/bmp;base64,"</span> &amp; toBase64(str(pixmap, BMP));
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="comment">(**
 *  Create submit button dialogElement with a ''dialogElement'' as label.
 *  @return a submit button dialogElement with the ''dialogElement''.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">submitButton</span>: submitButton (<span class="op">in</span> <span class="type">dialogElement</span>: element) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">submitButton</span>: aSubmitButton <span class="keywd">is</span> submitButton.value;
  <span class="keywd">begin</span>
    aSubmitButton.name := genDialogElementName;
    aSubmitButton.element := element;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: assignName (<span class="keywd">inout</span> <span class="type">submitButton</span>: aSubmitButton, <span class="keywd">inout</span> <span class="type">integer</span>: id) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">begin</span>
    aSubmitButton.name := <span class="stri">"name"</span> &lt;&amp; id;
    incr(id);
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">submitButton</span>: aSubmitButton, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">begin</span>
    aSubmitButton.activated := aSubmitButton.name <span class="op">in</span> paramHash;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">submitButton</span>: aSubmitButton) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("submitButton");</span>
    <span class="keywd">if</span> aSubmitButton.src &lt;> <span class="stri">""</span> <span class="keywd">then</span>
<span class="comment">#      content := "&lt;input type=\"image\" src=\"" &lt;&amp; aSubmitButton.src &lt;&amp;</span>
<span class="comment">#                 "\" name=\"" &lt;&amp; aSubmitButton.name &lt;&amp; "\" />\n";</span>
      content := <span class="stri">"&lt;button type=\"submit\" name=\""</span> &lt;&amp; aSubmitButton.name &lt;&amp; <span class="stri">"\">"</span> &lt;&amp;
                 <span class="stri">"&lt;img src=\""</span> &lt;&amp; aSubmitButton.src &lt;&amp; <span class="stri">"\">&lt;/button>\n"</span>;
    <span class="keywd">elsif</span> aSubmitButton.element &lt;> dialogElement.value <span class="keywd">then</span>
      content := <span class="stri">"&lt;button type=\"submit\" name=\""</span> &lt;&amp; aSubmitButton.name &lt;&amp; <span class="stri">"\">"</span> &lt;&amp;
                 toHtml(aSubmitButton.element) &lt;&amp;
                 <span class="stri">"&lt;/button>\n"</span>;
    <span class="keywd">elsif</span> aSubmitButton.label &lt;> <span class="stri">""</span> <span class="keywd">then</span>
      content := <span class="stri">"&lt;input type=\"submit\" name=\""</span> &lt;&amp; aSubmitButton.name &lt;&amp;
                 <span class="stri">"\" value=\""</span> &lt;&amp; aSubmitButton.label &lt;&amp; <span class="stri">"\" />\n"</span>;
    <span class="keywd">else</span>
      content := <span class="stri">"&lt;input type=\"submit\" name=\""</span> &lt;&amp; aSubmitButton.name &lt;&amp; <span class="stri">"\" />\n"</span>;
    <span class="keywd">end</span> <span class="keywd">if</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: closeButton <span class="keywd">is</span> new <span class="keywd">struct</span>
    <span class="keywd">var</span> <span class="type">string</span>: name <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">string</span>: label <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">boolean</span>: activated <span class="keywd">is</span> FALSE;
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(closeButton, dialogElement);

<span class="comment">(**
 *  Create a close button dialogElement with a [[string]] ''label''.
 *  @return a close button dialogElement with the ''label''.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">closeButton</span>: closeButton (<span class="op">in</span> <span class="type">string</span>: label) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">closeButton</span>: aCloseButton <span class="keywd">is</span> closeButton.value;
  <span class="keywd">begin</span>
    aCloseButton.name := genDialogElementName;
    aCloseButton.label := label;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: assignName (<span class="keywd">inout</span> <span class="type">closeButton</span>: aCloseButton, <span class="keywd">inout</span> <span class="type">integer</span>: id) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">begin</span>
    aCloseButton.name := <span class="stri">"name"</span> &lt;&amp; id;
    incr(id);
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">closeButton</span>: aCloseButton, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">begin</span>
    aCloseButton.activated := aCloseButton.name <span class="op">in</span> paramHash;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">closeButton</span>: aCloseButton) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("closeButton");</span>
    content := <span class="stri">"&lt;a href=\"javascript:close();\">"</span> &lt;&amp; aCloseButton.label &lt;&amp; <span class="stri">"&lt;/a>\n"</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: selection <span class="keywd">is</span> new <span class="keywd">struct</span>
    <span class="keywd">var</span> <span class="type">string</span>: name <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">integer</span>: size <span class="keywd">is</span> 0;
    <span class="keywd">var</span> <span class="type">array</span> <span class="type">string</span>: labelList <span class="keywd">is</span> 0 <span class="op">times</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">string</span>: selected <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(selection, dialogElement);

<span class="comment">(**
 *  Create a selection dialogElement with a ''size'' and a ''labelList''.
 *  @return a selection dialogElement.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">selection</span>: selection (<span class="op">in</span> <span class="type">integer</span>: size, <span class="op">in</span> <span class="type">array</span> <span class="type">string</span>: labelList) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">selection</span>: aSelectionList <span class="keywd">is</span> selection.value;
  <span class="keywd">begin</span>
    aSelectionList.name := genDialogElementName;
    aSelectionList.size := size;
    aSelectionList.labelList := labelList;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: assignName (<span class="keywd">inout</span> <span class="type">selection</span>: aSelectionList, <span class="keywd">inout</span> <span class="type">integer</span>: id) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">begin</span>
    aSelectionList.name := <span class="stri">"name"</span> &lt;&amp; id;
    incr(id);
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">selection</span>: aSelectionList, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">string</span>: label <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">begin</span>
    <span class="keywd">for</span> label <span class="keywd">range</span> aSelectionList.labelList <span class="keywd">do</span>
      <span class="keywd">if</span> aSelectionList.name <span class="op">in</span> paramHash <span class="op">and</span> paramHash[aSelectionList.name] = label <span class="keywd">then</span>
        aSelectionList.selected := label;
      <span class="keywd">end</span> <span class="keywd">if</span>;
    <span class="keywd">end</span> <span class="keywd">for</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">selection</span>: aSelectionList) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">string</span>: label <span class="keywd">is</span> <span class="stri">""</span>;
    <span class="keywd">var</span> <span class="type">string</span>: utf8Label <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("selection");</span>
    content := <span class="stri">"&lt;select name=\""</span> &lt;&amp; aSelectionList.name &lt;&amp; <span class="stri">"\" size=\""</span> &lt;&amp; aSelectionList.size &lt;&amp; <span class="stri">"\">\n"</span>;
    <span class="keywd">for</span> label <span class="keywd">range</span> aSelectionList.labelList <span class="keywd">do</span>
      utf8Label := toUtf8(label);
      content &amp;:= <span class="stri">"&lt;option value="</span> &lt;&amp; quoteHtmlAttrValue(utf8Label);
      <span class="keywd">if</span> aSelectionList.selected = label <span class="keywd">then</span>
        content &amp;:= <span class="stri">" selected=\"selected\""</span>;
      <span class="keywd">end</span> <span class="keywd">if</span>;
      content &amp;:= <span class="stri">">"</span> &lt;&amp; encodeHtmlContent(utf8Label) &lt;&amp; <span class="stri">"&lt;/option>\n"</span>;
    <span class="keywd">end</span> <span class="keywd">for</span>;
    content &amp;:= <span class="stri">"&lt;/select>\n"</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: dialogSequenceBase <span class="keywd">is</span> new <span class="keywd">struct</span>
    <span class="keywd">var</span> <span class="type">array</span> <span class="type">dialogElement</span>: elementList <span class="keywd">is</span> 0 <span class="op">times</span> dialogElement.value;
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(dialogSequenceBase, dialogElement);

<span class="comment">(**
 *  Concatenate two dialogElements.
 *  @return a dialogSequenceBase dialogElement.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">dialogSequenceBase</span>: (<span class="op">in</span> <span class="type">dialogElement</span>: element1) &amp; (<span class="op">in</span> <span class="type">dialogElement</span>: element2) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">dialogSequenceBase</span>: concatenation <span class="keywd">is</span> dialogSequenceBase.value;
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">dialogElement</span>: anElement <span class="keywd">is</span> dialogElement.value;
  <span class="keywd">begin</span>
    concatenation.elementList := 2 <span class="op">times</span> dialogElement.value;
    concatenation.elementList[1] := element1;
    concatenation.elementList[2] := element2;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">dialogSequenceBase</span>: (<span class="op">in</span> <span class="type">dialogSequenceBase</span>: sequence) &amp; (<span class="op">in</span> <span class="type">dialogElement</span>: element) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">dialogSequenceBase</span>: concatenation <span class="keywd">is</span> dialogSequenceBase.value;
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">dialogElement</span>: anElement <span class="keywd">is</span> dialogElement.value;
  <span class="keywd">begin</span>
    concatenation.elementList := sequence.elementList &amp; [] (element);
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: (<span class="keywd">inout</span> <span class="type">dialogSequenceBase</span>: sequence) &amp;:= (<span class="op">in</span> <span class="type">dialogElement</span>: element) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">begin</span>
    sequence.elementList &amp;:= element;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: assignName (<span class="keywd">inout</span> <span class="type">dialogSequenceBase</span>: aDialogSequenceBase, <span class="keywd">inout</span> <span class="type">integer</span>: id) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">dialogElement</span>: element <span class="keywd">is</span> dialogElement.value;
  <span class="keywd">begin</span>
    <span class="keywd">for</span> element <span class="keywd">range</span> aDialogSequenceBase.elementList <span class="keywd">do</span>
      assignName(element, id);
    <span class="keywd">end</span> <span class="keywd">for</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">dialogSequenceBase</span>: aDialogSequenceBase, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">dialogElement</span>: element <span class="keywd">is</span> dialogElement.value;
  <span class="keywd">begin</span>
    <span class="keywd">for</span> element <span class="keywd">range</span> aDialogSequenceBase.elementList <span class="keywd">do</span>
      update(element, paramHash);
    <span class="keywd">end</span> <span class="keywd">for</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: dialogSequence <span class="keywd">is</span> sub dialogSequenceBase <span class="keywd">struct</span>
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(dialogSequence, dialogElement);

<span class="comment">(**
 *  Create a dialogSequence dialogElement from a dialogSequenceBase.
 *  @return a dialogSequence dialogElement.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">dialogElement</span>: dialogSequence (<span class="op">in</span> <span class="type">dialogSequenceBase</span>: sequence) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">dialogElement</span>: newSequence <span class="keywd">is</span> dialogElement.value;
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">dialogSequence</span>: aDialogSequence <span class="keywd">is</span> dialogSequence.value;
  <span class="keywd">begin</span>
    aDialogSequence.elementList := sequence.elementList;
    newSequence := toInterface(aDialogSequence);
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="comment">(**
 *  Create a dialogSequence dialogElement from a dialogSequenceBase.
 *  @return a dialogSequence dialogElement.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">dialogElement</span>: dialogSequence (<span class="op">in</span> <span class="type">dialogElement</span>: element) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">dialogElement</span>: newSequence <span class="keywd">is</span> dialogElement.value;
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">dialogSequence</span>: aDialogSequence <span class="keywd">is</span> dialogSequence.value;
  <span class="keywd">begin</span>
    aDialogSequence.elementList := [] (element);
    newSequence := toInterface(aDialogSequence);
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">dialogSequence</span>: aDialogSequence) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">dialogElement</span>: element <span class="keywd">is</span> dialogElement.value;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("dialogSequence");</span>
    <span class="keywd">for</span> element <span class="keywd">range</span> aDialogSequence.elementList <span class="keywd">do</span>
      content &amp;:= toHtml(element);
    <span class="keywd">end</span> <span class="keywd">for</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: dialogColumn <span class="keywd">is</span> sub dialogSequenceBase <span class="keywd">struct</span>
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(dialogColumn, dialogElement);

<span class="comment">(**
 *  Create a dialogColumn dialogElement from a dialogSequenceBase.
 *  @return a dialogColumn dialogElement.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">dialogElement</span>: dialogColumn (<span class="op">in</span> <span class="type">dialogSequenceBase</span>: sequence) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">dialogElement</span>: newColumn <span class="keywd">is</span> dialogElement.value;
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">dialogColumn</span>: aDialogColumn <span class="keywd">is</span> dialogColumn.value;
  <span class="keywd">begin</span>
    aDialogColumn.elementList := sequence.elementList;
    newColumn := toInterface(aDialogColumn);
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">dialogColumn</span>: aDialogColumn) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">dialogElement</span>: element <span class="keywd">is</span> dialogElement.value;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("dialogColumn");</span>
    content := <span class="stri">"&lt;table cellspacing=\"0\" cellpadding=\"0\">\n"</span>;
    <span class="keywd">for</span> element <span class="keywd">range</span> aDialogColumn.elementList <span class="keywd">do</span>
      content &amp;:= <span class="stri">"&lt;tr>\n"</span>;
      content &amp;:= <span class="stri">"&lt;td>\n"</span>;
      content &amp;:= toHtml(element);
      content &amp;:= <span class="stri">"&lt;/td>\n"</span>;
      content &amp;:= <span class="stri">"&lt;/tr>\n"</span>;
    <span class="keywd">end</span> <span class="keywd">for</span>;
    content &amp;:= <span class="stri">"&lt;/table>\n"</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: dialogRow <span class="keywd">is</span> sub dialogSequenceBase <span class="keywd">struct</span>
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(dialogRow, dialogElement);

<span class="comment">(**
 *  Create a dialogRow dialogElement from a dialogSequenceBase.
 *  @return a dialogRow dialogElement.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">dialogElement</span>: dialogRow (<span class="op">in</span> <span class="type">dialogSequenceBase</span>: sequence) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">dialogElement</span>: newRow <span class="keywd">is</span> dialogElement.value;
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">dialogRow</span>: aDialogRow <span class="keywd">is</span> dialogRow.value;
  <span class="keywd">begin</span>
    aDialogRow.elementList := sequence.elementList;
    newRow := toInterface(aDialogRow);
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">dialogRow</span>: aDialogRow) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">dialogElement</span>: element <span class="keywd">is</span> dialogElement.value;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("dialogRow");</span>
    content := <span class="stri">"&lt;table cellspacing=\"0\" cellpadding=\"0\">\n"</span>;
    content &amp;:= <span class="stri">"&lt;tr>\n"</span>;
    <span class="keywd">for</span> element <span class="keywd">range</span> aDialogRow.elementList <span class="keywd">do</span>
      content &amp;:= <span class="stri">"&lt;td>\n"</span>;
      content &amp;:= toHtml(element);
      content &amp;:= <span class="stri">"&lt;/td>\n"</span>;
    <span class="keywd">end</span> <span class="keywd">for</span>;
    content &amp;:= <span class="stri">"&lt;/tr>\n"</span>;
    content &amp;:= <span class="stri">"&lt;/table>\n"</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;


<span class="keywd">const</span> <span class="type">type</span>: dialogTableRow <span class="keywd">is</span> <span class="type">array</span> <span class="type">dialogElement</span>;

<span class="keywd">const</span> <span class="type">type</span>: dialogTable <span class="keywd">is</span> new <span class="keywd">struct</span>
    <span class="keywd">var</span> <span class="type">dialogTableRow</span>: headers <span class="keywd">is</span> dialogTableRow.value;
    <span class="keywd">var</span> <span class="type">array</span> <span class="type">dialogTableRow</span>: elementTable <span class="keywd">is</span> 0 <span class="op">times</span> dialogTableRow.value;
  <span class="keywd">end</span> <span class="keywd">struct</span>;

type_implements_interface(dialogTable, dialogElement);

<span class="keywd">const</span> <span class="type">type</span>: sequenceArrayType <span class="keywd">is</span> <span class="type">array</span> <span class="type">dialogSequenceBase</span>;

<span class="comment">(**
 *  Create a dialogTable dialogElement from an array dialogSequenceBase.
 *  @return a dialogTable dialogElement.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">dialogElement</span>: dialogTable (<span class="op">in</span> <span class="type">dialogSequenceBase</span>: headers, <span class="op">in</span> <span class="type">array</span> <span class="type">dialogSequenceBase</span>: sequenceArray) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">dialogElement</span>: newTable <span class="keywd">is</span> dialogElement.value;
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">dialogTable</span>: aDialogTable <span class="keywd">is</span> dialogTable.value;
    <span class="keywd">var</span> <span class="type">integer</span>: row <span class="keywd">is</span> 0;
    <span class="keywd">var</span> <span class="type">integer</span>: column <span class="keywd">is</span> 0;
  <span class="keywd">begin</span>
    aDialogTable.headers := 0 <span class="op">times</span> dialogElement.value;
    <span class="keywd">for</span> column <span class="keywd">range</span> minIdx(headers.elementList) <span class="keywd">to</span> maxIdx(headers.elementList) <span class="keywd">do</span>
      aDialogTable.headers &amp;:= [] (headers.elementList[column]);
    <span class="keywd">end</span> <span class="keywd">for</span>;
    aDialogTable.elementTable := length(sequenceArray) <span class="op">times</span> 0 <span class="op">times</span> dialogElement.value;
    <span class="keywd">for</span> row <span class="keywd">range</span> minIdx(sequenceArray) <span class="keywd">to</span> maxIdx(sequenceArray) <span class="keywd">do</span>
      <span class="keywd">for</span> column <span class="keywd">range</span> minIdx(sequenceArray[row].elementList) <span class="keywd">to</span> maxIdx(sequenceArray[row].elementList) <span class="keywd">do</span>
        aDialogTable.elementTable[row] &amp;:= [] (sequenceArray[row].elementList[column]);
      <span class="keywd">end</span> <span class="keywd">for</span>;
    <span class="keywd">end</span> <span class="keywd">for</span>;
    newTable := toInterface(aDialogTable);
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">type</span>: tableDataStringArrayType <span class="keywd">is</span> <span class="type">array</span> <span class="type">array</span> string;

<span class="comment">(**
 *  Create a dialogTable dialogElement from an two dimensional string array.
 *  @return a dialogTable dialogElement.
 *)</span>
<span class="keywd">const</span> <span class="type">func</span> <span class="type">dialogElement</span>: dialogTable (<span class="op">in</span> <span class="type">dialogSequenceBase</span>: headers,
    <span class="op">in</span> <span class="type">tableDataStringArrayType</span>: tableData) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">dialogElement</span>: newTable <span class="keywd">is</span> dialogElement.value;
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">dialogTable</span>: aDialogTable <span class="keywd">is</span> dialogTable.value;
    <span class="keywd">var</span> <span class="type">integer</span>: row <span class="keywd">is</span> 0;
    <span class="keywd">var</span> <span class="type">integer</span>: column <span class="keywd">is</span> 0;
  <span class="keywd">begin</span>
    aDialogTable.headers := 0 <span class="op">times</span> dialogElement.value;
    <span class="keywd">for</span> column <span class="keywd">range</span> minIdx(headers.elementList) <span class="keywd">to</span> maxIdx(headers.elementList) <span class="keywd">do</span>
      aDialogTable.headers &amp;:= [] (headers.elementList[column]);
    <span class="keywd">end</span> <span class="keywd">for</span>;
    aDialogTable.elementTable := length(tableData) <span class="op">times</span> 0 <span class="op">times</span> dialogElement.value;
    <span class="keywd">for</span> <span class="keywd">key</span> row <span class="keywd">range</span> tableData <span class="keywd">do</span>
      <span class="keywd">for</span> <span class="keywd">key</span> column <span class="keywd">range</span> tableData[row] <span class="keywd">do</span>
        aDialogTable.elementTable[row] &amp;:= [] label(tableData[row][column]);
      <span class="keywd">end</span> <span class="keywd">for</span>;
    <span class="keywd">end</span> <span class="keywd">for</span>;
    newTable := toInterface(aDialogTable);
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: assignName (<span class="keywd">inout</span> <span class="type">dialogTable</span>: aDialogTable, <span class="keywd">inout</span> <span class="type">integer</span>: id) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">integer</span>: row <span class="keywd">is</span> 0;
    <span class="keywd">var</span> <span class="type">integer</span>: column <span class="keywd">is</span> 0;
  <span class="keywd">begin</span>
    <span class="keywd">for</span> row <span class="keywd">range</span> 1 <span class="keywd">to</span> length(aDialogTable.elementTable) <span class="keywd">do</span>
      <span class="keywd">for</span> column <span class="keywd">range</span> 1 <span class="keywd">to</span> length(aDialogTable.elementTable[row]) <span class="keywd">do</span>
        assignName(aDialogTable.elementTable[row][column], id);
      <span class="keywd">end</span> <span class="keywd">for</span>;
    <span class="keywd">end</span> <span class="keywd">for</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">proc</span>: update (<span class="keywd">inout</span> <span class="type">dialogTable</span>: aDialogTable, <span class="op">in</span> <span class="type">paramHashType</span>: paramHash) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">integer</span>: row <span class="keywd">is</span> 0;
    <span class="keywd">var</span> <span class="type">integer</span>: column <span class="keywd">is</span> 0;
  <span class="keywd">begin</span>
    <span class="keywd">for</span> row <span class="keywd">range</span> 1 <span class="keywd">to</span> length(aDialogTable.elementTable) <span class="keywd">do</span>
      <span class="keywd">for</span> column <span class="keywd">range</span> 1 <span class="keywd">to</span> length(aDialogTable.elementTable[row]) <span class="keywd">do</span>
        update(aDialogTable.elementTable[row][column], paramHash);
      <span class="keywd">end</span> <span class="keywd">for</span>;
    <span class="keywd">end</span> <span class="keywd">for</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;

<span class="keywd">const</span> <span class="type">func</span> <span class="type">string</span>: toHtml (<span class="op">in</span> <span class="type">dialogTable</span>: aDialogTable) <span class="keywd">is</span> <span class="keywd">func</span>
  <span class="keywd">result</span>
    <span class="keywd">var</span> <span class="type">string</span>: content <span class="keywd">is</span> <span class="stri">""</span>;
  <span class="keywd">local</span>
    <span class="keywd">var</span> <span class="type">integer</span>: row <span class="keywd">is</span> 0;
    <span class="keywd">var</span> <span class="type">integer</span>: column <span class="keywd">is</span> 0;
  <span class="keywd">begin</span>
    <span class="comment"># writeln("dialogTable");</span>
    content := <span class="stri">"&lt;table cellspacing=\"0\" cellpadding=\"4\" border=\"2\">\n"</span>;
    content &amp;:= <span class="stri">"&lt;tr>\n"</span>;
    <span class="keywd">for</span> column <span class="keywd">range</span> 1 <span class="keywd">to</span> length(aDialogTable.headers) <span class="keywd">do</span>
      content &amp;:= <span class="stri">"&lt;th>\n"</span>;
      content &amp;:= toHtml(aDialogTable.headers[column]);
      content &amp;:= <span class="stri">"&lt;/th>\n"</span>;
    <span class="keywd">end</span> <span class="keywd">for</span>;
    content &amp;:= <span class="stri">"&lt;/tr>\n"</span>;
    <span class="keywd">for</span> row <span class="keywd">range</span> 1 <span class="keywd">to</span> length(aDialogTable.elementTable) <span class="keywd">do</span>
      content &amp;:= <span class="stri">"&lt;tr>\n"</span>;
      <span class="keywd">for</span> column <span class="keywd">range</span> 1 <span class="keywd">to</span> length(aDialogTable.elementTable[row]) <span class="keywd">do</span>
        content &amp;:= <span class="stri">"&lt;td>\n"</span>;
        content &amp;:= toHtml(aDialogTable.elementTable[row][column]);
        content &amp;:= <span class="stri">"&lt;/td>\n"</span>;
      <span class="keywd">end</span> <span class="keywd">for</span>;
      content &amp;:= <span class="stri">"&lt;/tr>\n"</span>;
    <span class="keywd">end</span> <span class="keywd">for</span>;
    content &amp;:= <span class="stri">"&lt;/table>\n"</span>;
  <span class="keywd">end</span> <span class="keywd">func</span>;
</pre>
</body>
</html>
